<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>扫描线回放器（trace.v1/trace.v2）</title>
    <link rel="stylesheet" href="./reset.css" />
    <link rel="stylesheet" href="./style.css" />
  </head>
  <body>
    <header class="toolbar">
      <div class="toolbar__left">
        <label class="file-input">
          <span>加载 session.json</span>
          <input id="file-input" type="file" accept="application/json" />
        </label>
        <button id="reset-view" type="button">重置视图</button>
      </div>
      <div class="toolbar__right">
        <div class="playback">
          <button id="prev-step" type="button" title="←">上一步</button>
          <button id="play-pause" type="button" title="Space">播放</button>
          <button id="next-step" type="button" title="→">下一步</button>
          <label class="speed">
            速度
            <select id="speed">
              <option value="0.25">0.25x</option>
              <option value="0.5">0.5x</option>
              <option value="1" selected>1x</option>
              <option value="2">2x</option>
              <option value="4">4x</option>
            </select>
          </label>
        </div>
        <div class="view-options" aria-label="显示选项">
          <label class="toggle">
            <input id="show-cumulative-intersections" type="checkbox" checked />
            累计交点
          </label>
          <label class="range">
            累计大小
            <input
              id="cumulative-intersection-size"
              type="range"
              min="0.5"
              max="6"
              step="0.5"
              value="2"
            />
            <span id="cumulative-intersection-size-value" class="mono">2</span>
          </label>
          <label class="range">
            当前大小
            <input
              id="current-intersection-size"
              type="range"
              min="0.5"
              max="10"
              step="0.5"
              value="3.5"
            />
            <span id="current-intersection-size-value" class="mono">3.5</span>
          </label>
          <label class="toggle">
            <input id="bold-active-segments" type="checkbox" />
            激活加粗
          </label>
          <label class="theme">
            主题
            <select id="theme-mode">
              <option value="system" selected>跟随系统</option>
              <option value="light">浅色</option>
              <option value="dark">深色</option>
            </select>
          </label>
        </div>
        <div class="timeline">
          <input
            id="step-slider"
            type="range"
            min="0"
            max="0"
            value="0"
            aria-label="步骤"
          />
          <span id="step-label" class="mono">0/0</span>
        </div>
      </div>
    </header>

    <main class="layout">
      <aside class="list-panel" aria-label="示例列表">
        <section class="panel-section">
          <h2>示例列表</h2>
          <div class="list-actions">
            <button id="reload-index" type="button">刷新</button>
            <button
              id="open-session-picker"
              type="button"
              aria-haspopup="dialog"
              aria-controls="session-picker"
              title="打开示例选择器（Ctrl/⌘+K）"
            >
              浏览
            </button>
            <div class="segmented" role="group" aria-label="示例视图">
              <button
                id="session-list-view-list"
                type="button"
                class="segmented__button"
                data-mode="list"
                aria-pressed="true"
                aria-controls="session-list"
                title="列表视图"
              >
                列表
              </button>
              <button
                id="session-list-view-grid"
                type="button"
                class="segmented__button"
                data-mode="grid"
                aria-pressed="false"
                aria-controls="session-list"
                title="网格视图"
              >
                网格
              </button>
            </div>
          </div>
          <ul id="session-list" class="session-list"></ul>
          <div id="session-list-empty" class="muted">
            未找到索引：请运行 <span class="mono">pnpm gen:sessions</span> 生成
            <span class="mono">viewer/generated/index.json</span>，或手动加载
            <span class="mono">session.json</span>。
          </div>
        </section>
      </aside>

      <section id="viewport" class="viewport" aria-label="可视化画布区域">
        <div class="canvas-stack">
          <canvas id="static-canvas"></canvas>
          <canvas id="dynamic-canvas"></canvas>
        </div>
        <div id="drop-hint" class="drop-hint">
          拖拽 <span class="mono">session.json</span> 到此处加载
        </div>
      </section>

      <aside class="side-panel" aria-label="信息面板">
        <section class="panel-section">
          <h2>会话</h2>
          <div id="session-meta" class="kv mono"></div>
        </section>

        <section class="panel-section">
          <h2>告警</h2>
          <ol id="warnings" class="list"></ol>
        </section>

        <section class="panel-section">
          <h2>步骤</h2>
          <div id="step-meta" class="kv mono"></div>
          <details open>
            <summary>events</summary>
            <ol id="events" class="list mono"></ol>
          </details>
          <details>
            <summary>notes</summary>
            <ol id="notes" class="list mono"></ol>
          </details>
        </section>

        <section class="panel-section">
          <h2>active / intersections</h2>
          <details open>
            <summary>active</summary>
            <ol id="active" class="list mono"></ol>
          </details>
          <details open>
            <summary>intersections</summary>
            <table class="table mono">
              <thead>
                <tr>
                  <th>segments</th>
                  <th>kind</th>
                  <th>point</th>
                  <th>endpoint</th>
                  <th>interior</th>
                </tr>
              </thead>
              <tbody id="intersections"></tbody>
            </table>
          </details>
        </section>
      </aside>
    </main>

    <footer class="statusbar">
      <span id="status" role="status" aria-live="polite" aria-atomic="true"
        >未加载数据</span
      >
    </footer>

    <div
      id="session-picker"
      class="session-picker hidden"
      role="dialog"
      aria-modal="true"
      aria-labelledby="session-picker-title"
      aria-describedby="session-picker-hint"
      aria-hidden="true"
    >
      <div class="session-picker__surface" role="document">
        <div class="session-picker__header">
          <div id="session-picker-title" class="session-picker__title">
            选择示例
          </div>
          <input
            id="session-picker-search"
            type="text"
            class="session-picker__search"
            placeholder="搜索标题 / id / tag"
            autocomplete="off"
            aria-label="搜索示例"
          />
          <button id="session-picker-close" type="button">关闭</button>
        </div>
        <div class="session-picker__content">
          <ul
            id="session-picker-list"
            class="session-list session-list--grid"
          ></ul>
          <div id="session-picker-empty" class="muted" hidden>无匹配结果</div>
          <div id="session-picker-hint" class="muted">
            提示：按 <span class="mono">Esc</span> 关闭
          </div>
        </div>
      </div>
    </div>

    <script type="module" src="./app.js"></script>
  </body>
</html>
